<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Personality Features - FractalAI</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .feature-card {
            transition: transform 0.2s ease-in-out;
            border: 1px solid var(--bs-border-color);
        }
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .trait-slider {
            margin: 10px 0;
        }
        .result-container {
            max-height: 400px;
            overflow-y: auto;
            background: var(--bs-body-bg);
            border: 1px solid var(--bs-border-color);
            border-radius: 0.375rem;
            padding: 15px;
            margin-top: 15px;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .metric-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            margin: 0.125rem;
            background: var(--bs-primary);
            color: white;
            border-radius: 0.25rem;
            font-size: 0.8rem;
        }
        .timeline-item {
            border-left: 2px solid var(--bs-primary);
            padding-left: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--bs-primary);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="h2 mb-1">
                    <i class="fas fa-brain text-primary"></i>
                    Advanced Personality Features
                </h1>
                <p class="text-muted">Interactive training, communication learning, real-time analysis, and evolution tracking</p>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="featureTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="trainer-tab" data-bs-toggle="tab" data-bs-target="#trainer" type="button" role="tab">
                    <i class="fas fa-sliders-h"></i> Interactive Trainer
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="learner-tab" data-bs-toggle="tab" data-bs-target="#learner" type="button" role="tab">
                    <i class="fas fa-graduation-cap"></i> Communication Learner
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="explainer-tab" data-bs-toggle="tab" data-bs-target="#explainer" type="button" role="tab">
                    <i class="fas fa-search"></i> Trait Explainer
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="evolution-tab" data-bs-toggle="tab" data-bs-target="#evolution" type="button" role="tab">
                    <i class="fas fa-chart-line"></i> Evolution Tracker
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="featureTabContent">
            
            <!-- Interactive Personality Trainer -->
            <div class="tab-pane fade show active" id="trainer" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card feature-card">
                            <div class="card-header">
                                <h5><i class="fas fa-sliders-h text-primary"></i> Trait Adjustment</h5>
                            </div>
                            <div class="card-body">
                                <form id="traitAdjustmentForm">
                                    <div class="mb-3">
                                        <label for="sessionId" class="form-label">Session ID</label>
                                        <input type="text" class="form-control" id="sessionId" value="demo_session" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="traitName" class="form-label">Trait to Adjust</label>
                                        <select class="form-select" id="traitName" required>
                                            <option value="empathy">Empathy</option>
                                            <option value="humor">Humor</option>
                                            <option value="analyticalness">Analytical</option>
                                            <option value="creativity">Creativity</option>
                                            <option value="curiosity">Curiosity</option>
                                            <option value="supportiveness">Supportiveness</option>
                                            <option value="assertiveness">Assertiveness</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="adjustment" class="form-label">Adjustment (-1.0 to +1.0)</label>
                                        <input type="range" class="form-range" id="adjustment" min="-1" max="1" step="0.1" value="0.2">
                                        <div class="text-center">
                                            <span id="adjustmentValue">+0.2</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="reason" class="form-label">Reason for Adjustment</label>
                                        <textarea class="form-control" id="reason" rows="2" placeholder="Why make this adjustment?"></textarea>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-cog"></i> Adjust Trait
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <div class="card feature-card mt-3">
                            <div class="card-header">
                                <h5><i class="fas fa-lightbulb text-warning"></i> Scenario Suggestions</h5>
                            </div>
                            <div class="card-body">
                                <form id="scenarioSuggestionForm">
                                    <div class="mb-3">
                                        <label for="scenario" class="form-label">Target Scenario</label>
                                        <select class="form-select" id="scenario">
                                            <option value="help and support">Help & Support</option>
                                            <option value="funny and entertaining">Humor & Entertainment</option>
                                            <option value="professional business">Professional Business</option>
                                            <option value="creative innovation">Creative Innovation</option>
                                            <option value="calm and peaceful">Calm & Peaceful</option>
                                        </select>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fas fa-magic"></i> Get Suggestions
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card feature-card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-bar text-success"></i> Training Results</h5>
                            </div>
                            <div class="card-body">
                                <div id="trainerResults" class="result-container">
                                    <p class="text-muted text-center">Adjust traits to see results here...</p>
                                </div>
                                <div id="trainerLoading" class="loading-spinner">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Adaptive Communication Learner -->
            <div class="tab-pane fade" id="learner" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card feature-card">
                            <div class="card-header">
                                <h5><i class="fas fa-cogs text-info"></i> Style Preferences</h5>
                            </div>
                            <div class="card-body">
                                <form id="stylePreferencesForm">
                                    <div class="mb-3">
                                        <label for="learnerSessionId" class="form-label">Session ID</label>
                                        <input type="text" class="form-control" id="learnerSessionId" value="demo_session" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="formality" class="form-label">Communication Formality</label>
                                        <select class="form-select" id="formality">
                                            <option value="casual">Casual & Friendly</option>
                                            <option value="formal">Formal & Professional</option>
                                            <option value="balanced">Balanced</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="empathyLevel" class="form-label">Empathy Level: <span id="empathyValue">0.7</span></label>
                                        <input type="range" class="form-range trait-slider" id="empathyLevel" min="0" max="1" step="0.1" value="0.7">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="humorLevel" class="form-label">Humor Level: <span id="humorValue">0.5</span></label>
                                        <input type="range" class="form-range trait-slider" id="humorLevel" min="0" max="1" step="0.1" value="0.5">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="technicalLevel" class="form-label">Technical Level: <span id="technicalValue">0.6</span></label>
                                        <input type="range" class="form-range trait-slider" id="technicalLevel" min="0" max="1" step="0.1" value="0.6">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="supportLevel" class="form-label">Support Level: <span id="supportValue">0.8</span></label>
                                        <input type="range" class="form-range trait-slider" id="supportLevel" min="0" max="1" step="0.1" value="0.8">
                                    </div>
                                    
                                    <button type="submit" class="btn btn-info">
                                        <i class="fas fa-brain"></i> Learn Style
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card feature-card">
                            <div class="card-header">
                                <h5><i class="fas fa-analytics text-success"></i> Learning Results</h5>
                            </div>
                            <div class="card-body">
                                <div id="learnerResults" class="result-container">
                                    <p class="text-muted text-center">Set style preferences to see learning results...</p>
                                </div>
                                <div id="learnerLoading" class="loading-spinner">
                                    <div class="spinner-border text-info" role="status">
                                        <span class="visually-hidden">Learning...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time Trait Explainer -->
            <div class="tab-pane fade" id="explainer" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card feature-card">
                            <div class="card-header">
                                <h5><i class="fas fa-microscope text-warning"></i> Response Analysis</h5>
                            </div>
                            <div class="card-body">
                                <form id="explainerForm">
                                    <div class="mb-3">
                                        <label for="explainerSessionId" class="form-label">Session ID</label>
                                        <input type="text" class="form-control" id="explainerSessionId" value="demo_session" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="userInput" class="form-label">User Input</label>
                                        <textarea class="form-control" id="userInput" rows="2" placeholder="What did the user say?" required></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="aiResponse" class="form-label">AI Response</label>
                                        <textarea class="form-control" id="aiResponse" rows="3" placeholder="How did the AI respond?" required></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Current Trait Profile</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <small>Empathy: <span id="explainerEmpathyValue">0.7</span></small>
                                                <input type="range" class="form-range" id="explainerEmpathy" min="0" max="1" step="0.1" value="0.7">
                                            </div>
                                            <div class="col-6">
                                                <small>Humor: <span id="explainerHumorValue">0.5</span></small>
                                                <input type="range" class="form-range" id="explainerHumor" min="0" max="1" step="0.1" value="0.5">
                                            </div>
                                            <div class="col-6">
                                                <small>Analytical: <span id="explainerAnalyticalValue">0.6</span></small>
                                                <input type="range" class="form-range" id="explainerAnalytical" min="0" max="1" step="0.1" value="0.6">
                                            </div>
                                            <div class="col-6">
                                                <small>Creativity: <span id="explainerCreativityValue">0.5</span></small>
                                                <input type="range" class="form-range" id="explainerCreativity" min="0" max="1" step="0.1" value="0.5">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fas fa-search"></i> Analyze Influence
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card feature-card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie text-success"></i> Trait Influence Analysis</h5>
                            </div>
                            <div class="card-body">
                                <div id="explainerResults" class="result-container">
                                    <p class="text-muted text-center">Analyze a response to see trait influence...</p>
                                </div>
                                <div id="explainerLoading" class="loading-spinner">
                                    <div class="spinner-border text-warning" role="status">
                                        <span class="visually-hidden">Analyzing...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cross-Session Evolution Tracker -->
            <div class="tab-pane fade" id="evolution" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card feature-card">
                            <div class="card-header">
                                <h5><i class="fas fa-play text-success"></i> Track Evolution</h5>
                            </div>
                            <div class="card-body">
                                <form id="evolutionTrackForm">
                                    <div class="mb-3">
                                        <label for="evolutionSessionId" class="form-label">Session ID</label>
                                        <input type="text" class="form-control" id="evolutionSessionId" value="demo_session" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="eventType" class="form-label">Event Type</label>
                                        <select class="form-select" id="eventType">
                                            <option value="interaction">Interaction</option>
                                            <option value="training">Training</option>
                                            <option value="feedback">Feedback</option>
                                            <option value="adjustment">Adjustment</option>
                                        </select>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-camera"></i> Take Snapshot
                                    </button>
                                </form>
                                
                                <hr>
                                
                                <form id="evolutionAnalyticsForm">
                                    <div class="mb-3">
                                        <label for="daysBack" class="form-label">Analysis Period (days)</label>
                                        <select class="form-select" id="daysBack">
                                            <option value="7">Last 7 days</option>
                                            <option value="30">Last 30 days</option>
                                            <option value="90">Last 90 days</option>
                                        </select>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-chart-line"></i> View Analytics
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <div class="card feature-card">
                            <div class="card-header">
                                <h5><i class="fas fa-timeline text-info"></i> Evolution Timeline & Analytics</h5>
                            </div>
                            <div class="card-body">
                                <div id="evolutionResults" class="result-container">
                                    <p class="text-muted text-center">Track evolution or view analytics to see results...</p>
                                </div>
                                <div id="evolutionLoading" class="loading-spinner">
                                    <div class="spinner-border text-success" role="status">
                                        <span class="visually-hidden">Loading evolution data...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Real-time slider value updates
        function setupSliderUpdates() {
            // Adjustment slider
            document.getElementById('adjustment').addEventListener('input', function() {
                const value = parseFloat(this.value);
                document.getElementById('adjustmentValue').textContent = (value >= 0 ? '+' : '') + value.toFixed(1);
            });
            
            // Style preference sliders
            ['empathy', 'humor', 'technical', 'support'].forEach(trait => {
                const slider = document.getElementById(trait + 'Level');
                const display = document.getElementById(trait + 'Value');
                if (slider && display) {
                    slider.addEventListener('input', function() {
                        display.textContent = parseFloat(this.value).toFixed(1);
                    });
                }
            });
            
            // Explainer sliders
            ['empathy', 'humor', 'analytical', 'creativity'].forEach(trait => {
                const slider = document.getElementById('explainer' + trait.charAt(0).toUpperCase() + trait.slice(1));
                const display = document.getElementById('explainer' + trait.charAt(0).toUpperCase() + trait.slice(1) + 'Value');
                if (slider && display) {
                    slider.addEventListener('input', function() {
                        display.textContent = parseFloat(this.value).toFixed(1);
                    });
                }
            });
        }
        
        // API call helper
        async function apiCall(url, method = 'GET', data = null) {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            const response = await fetch(url, options);
            return await response.json();
        }
        
        // Display results helper
        function displayResults(containerId, data) {
            const container = document.getElementById(containerId);
            container.innerHTML = '<pre class="mb-0">' + JSON.stringify(data, null, 2) + '</pre>';
        }
        
        // Show/hide loading
        function toggleLoading(loadingId, show) {
            document.getElementById(loadingId).style.display = show ? 'block' : 'none';
        }
        
        // Interactive Personality Trainer
        document.getElementById('traitAdjustmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            toggleLoading('trainerLoading', true);
            
            const data = {
                session_id: document.getElementById('sessionId').value,
                trait_name: document.getElementById('traitName').value,
                adjustment: parseFloat(document.getElementById('adjustment').value),
                reason: document.getElementById('reason').value
            };
            
            try {
                const result = await apiCall('/api/personality/train/adjust', 'POST', data);
                displayResults('trainerResults', result);
            } catch (error) {
                displayResults('trainerResults', {error: error.message});
            }
            
            toggleLoading('trainerLoading', false);
        });
        
        // Scenario Suggestions
        document.getElementById('scenarioSuggestionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            toggleLoading('trainerLoading', true);
            
            const data = {
                session_id: document.getElementById('sessionId').value,
                target_scenario: document.getElementById('scenario').value
            };
            
            try {
                const result = await apiCall('/api/personality/train/suggest', 'POST', data);
                displayResults('trainerResults', result);
            } catch (error) {
                displayResults('trainerResults', {error: error.message});
            }
            
            toggleLoading('trainerLoading', false);
        });
        
        // Communication Style Learning
        document.getElementById('stylePreferencesForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            toggleLoading('learnerLoading', true);
            
            const data = {
                session_id: document.getElementById('learnerSessionId').value,
                style_preferences: {
                    formality: document.getElementById('formality').value,
                    empathy_level: parseFloat(document.getElementById('empathyLevel').value),
                    humor_level: parseFloat(document.getElementById('humorLevel').value),
                    technical_level: parseFloat(document.getElementById('technicalLevel').value),
                    supportiveness: parseFloat(document.getElementById('supportLevel').value)
                }
            };
            
            try {
                const result = await apiCall('/api/communication/learn_style', 'POST', data);
                displayResults('learnerResults', result);
            } catch (error) {
                displayResults('learnerResults', {error: error.message});
            }
            
            toggleLoading('learnerLoading', false);
        });
        
        // Trait Explainer
        document.getElementById('explainerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            toggleLoading('explainerLoading', true);
            
            const data = {
                session_id: document.getElementById('explainerSessionId').value,
                user_input: document.getElementById('userInput').value,
                ai_response: document.getElementById('aiResponse').value,
                trait_profile: {
                    empathy: parseFloat(document.getElementById('explainerEmpathy').value),
                    humor: parseFloat(document.getElementById('explainerHumor').value),
                    analyticalness: parseFloat(document.getElementById('explainerAnalytical').value),
                    creativity: parseFloat(document.getElementById('explainerCreativity').value)
                }
            };
            
            try {
                const result = await apiCall('/api/traits/explain_realtime', 'POST', data);
                displayResults('explainerResults', result);
            } catch (error) {
                displayResults('explainerResults', {error: error.message});
            }
            
            toggleLoading('explainerLoading', false);
        });
        
        // Evolution Tracker
        document.getElementById('evolutionTrackForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            toggleLoading('evolutionLoading', true);
            
            const sessionId = document.getElementById('evolutionSessionId').value;
            const data = {
                event_type: document.getElementById('eventType').value
            };
            
            try {
                const result = await apiCall(`/api/evolution/track/${sessionId}`, 'POST', data);
                displayResults('evolutionResults', result);
            } catch (error) {
                displayResults('evolutionResults', {error: error.message});
            }
            
            toggleLoading('evolutionLoading', false);
        });
        
        // Evolution Analytics
        document.getElementById('evolutionAnalyticsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            toggleLoading('evolutionLoading', true);
            
            const daysBack = document.getElementById('daysBack').value;
            
            try {
                const result = await apiCall(`/api/evolution/analytics?days_back=${daysBack}`);
                displayResults('evolutionResults', result);
            } catch (error) {
                displayResults('evolutionResults', {error: error.message});
            }
            
            toggleLoading('evolutionLoading', false);
        });
        
        // Initialize slider updates when page loads
        document.addEventListener('DOMContentLoaded', setupSliderUpdates);
    </script>
</body>
</html>